From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: ruViolence <78062896+ruViolence@users.noreply.github.com>
Date: Sat, 20 Apr 2024 19:46:52 +0800
Subject: [PATCH] fix: randar exploit

https://github.com/spawnmason/randar-explanation

diff --git a/src/main/java/net/minecraft/server/World.java b/src/main/java/net/minecraft/server/World.java
index 37381407f8b3c76aa72eb8e29bf4adc45dc97734..99774b0a68932e09e31974448979125e00bc7862 100644
--- a/src/main/java/net/minecraft/server/World.java
+++ b/src/main/java/net/minecraft/server/World.java
@@ -88,6 +88,7 @@ public abstract class World implements IBlockAccess {
     protected float q;
     private int M;
     public final Random random = new Random();
+    private final Random worldGenRandom = new Random(); // Reaper - Fix Randar
     public WorldProvider worldProvider;
     protected NavigationListener t = new NavigationListener();
     protected List<IWorldAccess> u;
@@ -3334,8 +3335,14 @@ public abstract class World implements IBlockAccess {
     public Random a(int i, int j, int k) {
         long l = (long) i * 341873128712L + (long) j * 132897987541L + this.getWorldData().getSeed() + (long) k;
 
+        // Reaper start - Fix Randar
+        if (false) {
         this.random.setSeed(l);
         return this.random;
+        }
+        this.worldGenRandom.setSeed(l);
+        return this.worldGenRandom;
+        // Reaper end - Fix Randar
     }
 
     public CrashReportSystemDetails a(CrashReport crashreport) {
